<style>
    .workspace {
        border: 1px solid #aaa;
        display: flex;
        flex-direction: row;
        overflow: hidden;
        position: relative;
    }

    .workspace .frame {
        margin: 3px;
        border: 1px dashed #888;
        overflow: hidden;
        flex: 4;
        position: relative;
        height: 90vh;

    }


    .workspace .palette {
        padding: 2px;
        display: flex;
        flex-wrap: wrap;
        flex: 1;
    }



    .palette .item button,
    .hoz,
    .vez {
        display: none;
    }

    .palette .item {
        display: flex;
        z-index: 6;
        position: relative;
        flex: 0;
    }

    .panzoom .item-map {

        position: absolute;
    }

    .workspace .item__group {
        border: 1px solid #aaa;
        padding: 2px;
        background: rgba(0, 0, 255, 0.3);
        cursor: pointer;
        display: flex;

    }

    .workspace .item-map .item__group.active {
        border: 3px solid #333;

    }




    .panzoom {
        width: 2048px;
        height: 2048px;
        border: 3px solid blue;

        background-position: center;
        background-size: contain;
        margin: 0 auto;
        overflow: visible;
        background-color: #fff;
        background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
        background-position: -2px -2px, -2px -2px, -1px -1px, -1px -1px;

        background-image: linear-gradient(grey 2px, transparent 2px),
            linear-gradient(90deg, grey 2px, transparent 2px),
            linear-gradient(rgba(128, 128, 128, 0.233) 1px, transparent 1px),
            linear-gradient(90deg, rgba(128, 128, 128, 0.233) 1px, transparent 1px);

    }

    .item-map button {
        display: flex;
        position: absolute;
        width: 15px;
        height: 15px;
        top: -10px;
        right: -10px;
        background-color: red;
        border: none;
        padding: 0;
        align-items: center;
        justify-content: center;
    }

    .panzoom-control {
        right: 20px;
        padding: 4px;
        display: flex;
        align-content: center;
        flex-direction: column;
    }

    .panzoom-control button {
        border: none;
        background-color: #fff;
        box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.2);
        transition: box-shadow 0.1s ease-out, background-color 0.1s ease-out;
        height: 40px;
        width: 35px;
    }

    .hoz {
        position: absolute;
        background-color: red;
        width: .1px;
        top: 0px;
        bottom: 0px;
        height: 200vh;
        transform: translateY(-100vh);
    }

    .vez {
        position: absolute;
        background-color: red;
        height: .1px;
        left: 0px;
        right: 0px;
        width: 200vh;
        transform: translateX(-100vh);
    }

    .line .hoz,
    .line .vez {
        display: initial;
    }


    .context {
        font-size: 1.1em;
        position: absolute;
        width: 200px;
        height: auto;
        padding: 5px 0px;
        border-radius: 5px;
        top: 10;
        left: 10;
        background-color: #fff;
        box-shadow: 0 12px 15px 0 rgba(0, 0, 0, 0.24);
        color: #333;
    }

    .context .context_item {
        height: 32px;
        line-height: 32px;
        cursor: pointer;
        text-overflow: ellipsis;
        overflow: hidden;
        grey-space: nowrap;
    }

    .context .context_item:hover {
        background-color: #ddd;
    }

    .context .context_item .inner_item {
        margin: 0px 10px;
    }

    .context .context_item .inner_item i {
        margin: 0 5px 0 0;
        font-weight: bold;
    }

    .context .context_hr {
        height: 1px;
        border-top: 1px solid #bbb;
        margin: 3px 10px;
    }


    div.timeline-medical-history {
        width: 700px;
        display: block;
        border: 1px solid #cccccc;
        padding: 10px;
        box-sizing: border-box;
    }

    div.timeline-medical-history ul {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        list-style: none;
        width: 100%;
        border-bottom: 4px solid #aaaaaa;
        box-sizing: border-box;
    }

    div.timeline-medical-history ul li {
        margin: 0;
        padding: 0;
        border-left: 2px solid #009;
        position: relative;
        line-height: 1;
    }

    div.timeline-medical-history ul li::before {
        position: absolute;
        content: "";
        width: 14px;
        height: 14px;
        background-color: #009;
        bottom: 0;
        left: 0;
        transform: translateX(-60%) translateY(50%);
        border-radius: 50%;
    }

    div.timeline-medical-history ul li .year-event {
        color: red;
        font-size: 10px;
        padding: 5px;
        padding-bottom: 0;
    }

    div.timeline-medical-history ul li .event-desc {
        font-size: 12px;
        padding: 5px;
        font-weight: 700;
    }
</style>

<div class="workspace">

    <div class="palette" id="palette">
        <div class="item" id="item-1">
            <div class="item__group">
                Item 1

                <div class="timeline-medical-history">
                    <h4>Relative 1</h4>
                    <ul>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                            </div>
                        </li>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                                <div class="event-desc">Heart surgery 2</div>
                            </div>
                        </li>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                            </div>
                        </li>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <button type="button" onclick="remove('item-1')">x</button>

            <div class="hoz"></div>
            <div class="vez"></div>
        </div>
        <div class="item" id="item-3">
            <div class="item__group">
                Item 3
            </div>
            <button type="button" onclick="remove('item-3')">x</button>

            <div class="hoz"></div>
            <div class="vez"></div>
        </div>
        <div class="item" id="item-2">
            <div class="item__group">
                <div class="timeline-medical-history">
                    <h4>Relative 1</h4>
                    <ul>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                            </div>
                        </li>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                                <div class="event-desc">Heart surgery 2</div>
                            </div>
                        </li>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                            </div>
                        </li>
                        <li>
                            <div class="event-container">
                                <div class="year-event">1991</div>
                                <div class="event-desc">Heart surgery</div>
                            </div>
                        </li>
                    </ul>
                </div>
                Item 2
            </div>
            <button type="button" onclick="remove('item-2')">x</button>


            <div class="hoz"></div>
            <div class="vez"></div>
        </div>
    </div>

    <div class="frame">
        <div class="panzoom" panzoom-scale="1">
            <div class="item-map" id="item-5">
                <div class="item__group">
                    Item 5
                </div>
                <button type="button" onclick="remove('item-5')">x</button>


                <div class="hoz"></div>
                <div class="vez"></div>
            </div>
            <div class="item-map" id="item-6">
                <div class="item__group">
                    <div class="timeline-medical-history">
                        <h4>Relative 1</h4>
                        <ul>
                            <li>
                                <div class="event-container">
                                    <div class="year-event">1991</div>
                                    <div class="event-desc">Heart surgery</div>
                                </div>
                            </li>
                            <li>
                                <div class="event-container">
                                    <div class="year-event">1991</div>
                                    <div class="event-desc">Heart surgery</div>
                                    <div class="event-desc">Heart surgery 2</div>
                                </div>
                            </li>
                            <li>
                                <div class="event-container">
                                    <div class="year-event">1991</div>
                                    <div class="event-desc">Heart surgery</div>
                                </div>
                            </li>
                            <li>
                                <div class="event-container">
                                    <div class="year-event">1991</div>
                                    <div class="event-desc">Heart surgery</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    Item 6
                </div>
                <button type="button" onclick="remove('item-6')">x</button>


                <div class="hoz"></div>
                <div class="vez"></div>
            </div>
        </div>

    </div>
    <div class="panzoom-control">
        <button id="bt-zoom-in" class="rounded-top" title="">+</button>
        <button id="bt-reset" class="rounded-0">x</button>
        <button id="bt-zoom-out" class="rounded-bottom" title="">-</button>
    </div>


</div>

<div class="context" hidden>
    <div class="context_item">
        <div class="inner_item">
            Copy
        </div>
    </div>
    <div class="context_item">
        <div class="inner_item">
            Cut
        </div>
    </div>
    <div class="context_item">
        <div class="inner_item">
            Paste
        </div>
    </div>
    <div class="context_hr"></div>
    <div class="context_item">
        <div class="inner_item">
            Share
        </div>
    </div>
    <div class="context_item">
        <div class="inner_item">
            Delete
        </div>
    </div>

    <div class="context_item" onclick="closemenu()">
        <div class="inner_item">
            Close
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
<script src="https://cdn.rawgit.com/YuriGor/jquery.panzoom/ignoreChildrensEvents/dist/jquery.panzoom.min.js"></script>

<script>

    var viewport = $('.frame');
    var $pz = $('.panzoom');

    var optionDraggablePalette = {
        revert: true,
        create: null,
        start: null,
        drag: null,
        stop: null,
    }


    var optionDraggableMap = {
        revert: false,



        start: function (event, ui) {


            var zoom = $pz.attr('panzoom-scale') || 1;
            pointerY = (event.pageY - $pz.offset().top) / zoom - parseInt($(event.target).css('top'));
            pointerX = (event.pageX - $pz.offset().left) / zoom - parseInt($(event.target).css('left'));
            ui.helper.addClass('line');

        },


        drag: function (event, ui) {
            var zoom = $pz.attr('panzoom-scale') || 1;
            var canvasTop = $pz.offset().top;
            var canvasLeft = $pz.offset().left;
            var canvasHeight = $pz.height() / zoom;
            var canvasWidth = $pz.width() / zoom;



            ui.position.top = Math.round(
                (event.pageY - canvasTop) / zoom - pointerY);
            ui.position.left = Math.round(
                (event.pageX - canvasLeft) / zoom - pointerX);

            if (ui.position.left < 0) ui.position.left = 0;
            if (ui.position.left + $(this).width() >
                canvasWidth) ui.position.left = canvasWidth - $(this).width() /
                    zoom;
            if (ui.position.top < 0) ui.position.top = 0;
            if (ui.position.top + $(this).height() > canvasHeight) ui.position.top = canvasHeight - $(this).height() / zoom;

            ui.offset.top = Math.round(ui.position.top + canvasTop);
            ui.offset.left = Math.round(ui.position.left + canvasLeft);
        },

        stop: function (event, ui) {
            ui.helper.removeClass('line');

        },
    }


    $pz.panzoom({
        minScale: .5,
        maxScale: 3,
    });

    viewport
        .on('wheel', function (event) {
            var delta = event.delta || event.originalEvent.wheelDelta;
            var zoomOut = delta ? delta < 0 : event.originalEvent.deltaY > 0;
            $pz.panzoom('zoom', zoomOut, {
                minScale: .5,
                maxScale: 3,
            });
        });

    $pz.on('panzoomchange', function (event, panzoom, transform) {
        $pz.attr('panzoom-scale', transform[0]);
    });




    window.addEventListener("keydown", function (event) {
        if (event.which == 32) {
            $pz.panzoom('disable');
            $(".context")
                .hide()
        }


    });
    window.addEventListener("keyup", function (event) {
        if (event.which == 32) {
            $pz.panzoom('enable');
            $(".context")
                .hide()
        }
    });


    $('.item').draggable(optionDraggablePalette)


    $('.item-map').draggable(optionDraggableMap)



    $pz.droppable({
        accept: '.item',
        drop: function (event, ui) {
            var pzmatrix = $pz.panzoom('getMatrix');
            var currentScale = pzmatrix[0];

            var pzoff = $pz.offset();
            var newPos = {
                top: (ui.offset.top - pzoff.top) / currentScale,
                left: (ui.offset.left - pzoff.left) / currentScale,

            };


            ui.draggable.css(newPos);
            ui.draggable.appendTo($pz)



            ui.draggable.removeClass('item').addClass('item-map')
                .draggable(optionDraggableMap)

            handlemenu()
        },
    });

    $('#bt-zoom-in').on('click', function () {
        $pz.panzoom('zoom', false);
    });

    $('#bt-zoom-out').on('click', function () {
        $pz.panzoom('zoom', true);
    });

    $('#bt-reset').on('click', function () {
        $pz.panzoom('reset');
    });

    function remove(iditem) {
        $(`#${iditem}`).removeAttr('style')
            .removeClass('item-map')
            .addClass('item')
            .draggable(optionDraggablePalette)
            .appendTo('#palette');



    }



    function handlemenu() {

        $('.item-map .item__group').on("contextmenu", function (event) {
            event.preventDefault();
            $(".context")
                .show()
                .css({
                    top: event.pageY,
                    left: event.pageX
                });
        });

        $('.item-map .item__group').click(function (event) {
            if ($(".context").is(":hover") == false) {
                $(".context").fadeOut("fast");
            };

            $('.item-map .item__group').removeClass('active');


            if (!$(this).hasClass('active')) {
                $(this).addClass('active');
            }
        });

        $(document).mousedown(function () {

            $(".context")
                .hide()
        })
    }


    function closemenu() {

        $(".context")
            .hide()
    }

    $(document).ready(function () {
        handlemenu()
    });

</script>